name: 微信日志推送

on:
  # 仅支持手动触发
  workflow_dispatch:

jobs:
  send-wechat:
    runs-on: ubuntu-latest
    
    steps:
    # 1. 检出代码
    - name: 检出仓库代码
      uses: actions/checkout@v3
    
    # 2. 设置 Python 环境
    - name: 设置 Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    # 3. 安装依赖
    - name: 安装 Python 依赖
      run: |
        python -m pip install --upgrade pip
        pip install requests
    
    # 4. 检查文件是否存在
    - name: 检查日志文件
      run: |
        if [ -f "select_results.log" ]; then
          echo "✅ 日志文件存在"
          cat select_results.log
        else
          echo "⚠️ 日志文件不存在，创建测试日志"
          echo "这是一个测试日志内容 - $(date)" > select_results.log
        fi
    
    # 5. 运行微信推送脚本
    - name: 运行微信推送
      env:
        SENDKEY: ${{ secrets.WECHAT_SENDKEY }}  # 从 GitHub Secrets 读取
      run: |
        python wechatsend.py
    
    # 6. 上传运行日志 (可选，用于调试)
    - name: 上传运行日志
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: workflow-logs
        path: |
          select_results.log
        retention-days: 7
